<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>Lab S-7: Spectrograms of AM and FM Signals -- Benson Willie</title>
<meta name="generator" content="MATLAB 25.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-12-02">
<meta name="DC.source" content="lab_s7_specgrams_amfm.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h1>Lab S-7: Spectrograms of AM and FM Signals -- Benson Willie</h1>
<!--introduction-->
<!--/introduction-->
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">2.1.1 MATLAB Code for Beat Signals</a>
</li>
<li>
<a href="#2">2.1.2 Beat Note Spectrograms</a>
</li>
<li>
<a href="#3">2.1.3 Inverse Relationship: Section Length vs Frequency Resolution</a>
</li>
<li>
<a href="#4">Functions</a>
</li>
</ul>
</div>
<h2 id="1">2.1.1 MATLAB Code for Beat Signals</h2>
<pre class="codeinput">Amp = 10;        <span class="comment">% B</span>
fc  = 1024;      <span class="comment">% center frequency (Hz)</span>
fDelta = 4;      <span class="comment">% modulating frequency f_Δ (Hz)</span>
phic = 2*pi*rand;        <span class="comment">% random phase φ_c</span>
phiDelta = 2*pi*rand;    <span class="comment">% random phase φ_Δ</span>
tStart = 0;      <span class="comment">% start time (s)</span>
tStop  = 5;      <span class="comment">% stop time (s)</span>
fs = 8000;       <span class="comment">% sampling rate (samples/s)</span>

tt = tStart:1/fs:tStop;
xx = Amp*cos(2*pi*fc*tt + phic) .* cos(2*pi*fDelta*tt + phiDelta);

<span class="comment">% Plot time signal (first 0.5 sec to see beat envelope)</span>
figure; plot(tt, xx); xlim([0 0.5]); grid <span class="string">on</span>;
title(<span class="string">'Beat signal, f_\Delta = 4 Hz'</span>);
xlabel(<span class="string">'Time (s)'</span>); ylabel(<span class="string">'Amplitude'</span>);
</pre>
<img vspace="5" hspace="5" src="lab_s7_specgrams_amfm_01.png" alt=""> <h2 id="2">2.1.2 Beat Note Spectrograms</h2>
<pre class="codeinput">
<span class="comment">% Expected spectral lines from:</span>
<span class="comment">% cos a cos b = (1/2)[cos(a+b) + cos(a-b)]</span>
<span class="comment">% -&gt; tones at f_c &plusmn; f_Δ</span>

f1 = fc - fDelta;
f2 = fc + fDelta;
disp(<span class="string">"Expected spectral lines (Hz): "</span> + f1 + <span class="string">" and "</span> + f2);

<span class="comment">% Spectrograms with increasing section length</span>
Llist = [256 512 1024 2048 2500 3000 3500 4096 8192];

<span class="keyword">for</span> Lsect = Llist
    do_spec(xx, fs, Lsect, sprintf(<span class="string">'Beat spectrogram, L_{SECT}=%d'</span>, Lsect), false);
<span class="keyword">end</span>

<span class="comment">% Smallest section length that resolves two lines (from your observation)</span>
Lsect_min = 3000;
Tsect_min = Lsect_min/fs;

<span class="comment">% Comment for 2.1.2(c):</span>
<span class="comment">% At L_SECT=256, the spectrogram shows a single thick band near 1024 Hz</span>
<span class="comment">% (not two separate horizontal lines) &rarr; insufficient frequency resolution.</span>

<span class="comment">% RESULTS (2.1.2):</span>
<span class="comment">% Expected spectral lines: f1 = 1020 Hz, f2 = 1028 Hz.</span>
<span class="comment">% Smallest L_SECT resolving two lines: L_SECT,min = 3000 samples.</span>
<span class="comment">% T_SECT,min = L_SECT,min / fs = 3000/8000 = 0.375 s.</span>
</pre>
<pre class="codeoutput">Expected spectral lines (Hz): 1020 and 1028
</pre>
<img vspace="5" hspace="5" src="lab_s7_specgrams_amfm_02.png" alt=""> <img vspace="5" hspace="5" src="lab_s7_specgrams_amfm_03.png" alt=""> <img vspace="5" hspace="5" src="lab_s7_specgrams_amfm_04.png" alt=""> <img vspace="5" hspace="5" src="lab_s7_specgrams_amfm_05.png" alt=""> <img vspace="5" hspace="5" src="lab_s7_specgrams_amfm_06.png" alt=""> <img vspace="5" hspace="5" src="lab_s7_specgrams_amfm_07.png" alt=""> <img vspace="5" hspace="5" src="lab_s7_specgrams_amfm_08.png" alt=""> <img vspace="5" hspace="5" src="lab_s7_specgrams_amfm_09.png" alt=""> <img vspace="5" hspace="5" src="lab_s7_specgrams_amfm_10.png" alt=""> <h2 id="3">2.1.3 Inverse Relationship: Section Length vs Frequency Resolution</h2>
<pre class="codeinput">
<span class="comment">% (a) Determine proportionality constant C from:</span>
<span class="comment">% |f1 - f2| = C / T_SECT</span>

df = abs(f2 - f1);        <span class="comment">% separation for fDelta = 4  (8 Hz)</span>
C  = df * Tsect_min;      <span class="comment">% C = |f1-f2| * T_SECT,min = 8 * 0.375 = 3.0</span>
disp(<span class="string">"Computed C = "</span> + C);

<span class="comment">% (b) Change fDelta to 16 Hz, predict Lsect, then verify</span>
fDelta2 = 16;
f1b = fc - fDelta2;       <span class="comment">% 1008 Hz</span>
f2b = fc + fDelta2;       <span class="comment">% 1040 Hz</span>
df2 = abs(f2b - f1b);     <span class="comment">% 32 Hz separation</span>

Tsect_pred = C/df2;       <span class="comment">% predicted section duration</span>
Lsect_pred = Tsect_pred * fs;    <span class="comment">% predicted length in samples (&asymp; 750)</span>
Lsect_use  = 1024;        <span class="comment">% convenient power-of-two window close to prediction</span>

disp(<span class="string">"Predicted Tsect for fDelta=16: "</span> + Tsect_pred + <span class="string">" s"</span>);
disp(<span class="string">"Predicted Lsect (theoretical) for fDelta=16: "</span> + Lsect_pred);
disp(<span class="string">"Using Lsect = "</span> + Lsect_use + <span class="string">" samples for spectrogram."</span>);

<span class="comment">% Generate new beat signal and verify resolution</span>
xx2 = Amp*cos(2*pi*fc*tt + 2*pi*rand) .* cos(2*pi*fDelta2*tt + 2*pi*rand);
do_spec(xx2, fs, Lsect_use, <span class="keyword">...</span>
    sprintf(<span class="string">'f_\\Delta=16 spectrogram, L_{SECT}=%d'</span>, Lsect_use), false);

<span class="comment">% RESULTS (2.1.3):</span>
<span class="comment">% |f1-f2| = 8 Hz for fDelta = 4.</span>
<span class="comment">% Measured minimum section length: L_SECT,min = 3000 samples</span>
<span class="comment">% &rarr; T_SECT,min = 3000/8000 = 0.375 s.</span>
<span class="comment">% Proportionality constant: C = |f1-f2| * T_SECT,min = 8 * 0.375 = 3.0.</span>
<span class="comment">%</span>
<span class="comment">% For fDelta = 16, the two tones are at 1008 Hz and 1040 Hz</span>
<span class="comment">% &rarr; |f1-f2| = 32 Hz.</span>
<span class="comment">% Predicted T_SECT = C / |f1-f2| = 3 / 32 &asymp; 0.09375 s</span>
<span class="comment">% &rarr; Predicted L_SECT &asymp; 0.09375 * 8000 = 750 samples.</span>
<span class="comment">% In practice, we used L_SECT = 1024 (a nearby power of two).</span>
<span class="comment">% The spectrogram with L_SECT = 1024 clearly shows two distinct lines</span>
<span class="comment">% near 1008 Hz and 1040 Hz, confirming that the inverse relationship</span>
<span class="comment">% is a good approximation.</span>
</pre>
<pre class="codeoutput">Computed C = 3
Predicted Tsect for fDelta=16: 0.09375 s
Predicted Lsect (theoretical) for fDelta=16: 750
Using Lsect = 1024 samples for spectrogram.
</pre>
<h2 id="4">Functions</h2>
<pre class="codeinput">
<span class="keyword">function</span> do_spec(x, fs, Lsect, titleStr, twoSided)
    <span class="keyword">if</span> nargin &lt; 5, twoSided = false; <span class="keyword">end</span>
    figure;

    <span class="comment">% If DSP-First plotspec exists, use it</span>
    <span class="keyword">if</span> exist(<span class="string">'plotspec'</span>,<span class="string">'file'</span>) == 2
        <span class="keyword">if</span> twoSided
            plotspec(x + 1j*1e-12, fs, Lsect); <span class="comment">% two-sided trick</span>
        <span class="keyword">else</span>
            plotspec(x, fs, Lsect);
        <span class="keyword">end</span>
        colorbar; grid <span class="string">on</span>; title(titleStr);
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    <span class="comment">% ---- Toolbox-free STFT fallback ----</span>
    overlap = floor(Lsect/2);
    hop = Lsect - overlap;
    Nfft = Lsect;

    <span class="comment">% Custom Hamming window (no toolbox)</span>
    n = (0:Lsect-1).';
    w = 0.54 - 0.46*cos(2*pi*n/(Lsect-1));

    nFrames = floor((length(x) - Lsect)/hop) + 1;
    S = zeros(Nfft, nFrames);

    <span class="keyword">for</span> m = 1:nFrames
        idx = (1:Lsect) + (m-1)*hop;
        frame = x(idx);
        frame = frame(:).*w;
        S(:,m) = fft(frame, Nfft);
    <span class="keyword">end</span>

    T = ((0:nFrames-1)*hop + Lsect/2)/fs;

    <span class="keyword">if</span> twoSided
        Splot = fftshift(S,1);
        F = (-Nfft/2:Nfft/2-1)/Nfft * fs;
    <span class="keyword">else</span>
        halfN = floor(Nfft/2);
        Splot = S(1:halfN+1, :);
        F = (0:halfN)/Nfft * fs;
    <span class="keyword">end</span>

    Mag = 20*log10(abs(Splot) + 1e-12);

    imagesc(T, F, Mag);
    axis <span class="string">xy</span>; colorbar;
    xlabel(<span class="string">'Time (s)'</span>); ylabel(<span class="string">'Frequency (Hz)'</span>);
    title([titleStr <span class="string">' (STFT fallback)'</span>]);
    grid <span class="string">on</span>;
<span class="keyword">end</span>
</pre>
<p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2025b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Lab S-7: Spectrograms of AM and FM Signals REPLACE_WITH_DASH_DASH Benson Willie

%% 2.1.1 MATLAB Code for Beat Signals

Amp = 10;        % B
fc  = 1024;      % center frequency (Hz)
fDelta = 4;      % modulating frequency f_Δ (Hz)
phic = 2*pi*rand;        % random phase φ_c
phiDelta = 2*pi*rand;    % random phase φ_Δ
tStart = 0;      % start time (s)
tStop  = 5;      % stop time (s)
fs = 8000;       % sampling rate (samples/s)

tt = tStart:1/fs:tStop;
xx = Amp*cos(2*pi*fc*tt + phic) .* cos(2*pi*fDelta*tt + phiDelta);

% Plot time signal (first 0.5 sec to see beat envelope)
figure; plot(tt, xx); xlim([0 0.5]); grid on;
title('Beat signal, f_\Delta = 4 Hz');
xlabel('Time (s)'); ylabel('Amplitude');


%% 2.1.2 Beat Note Spectrograms

% Expected spectral lines from:
% cos a cos b = (1/2)[cos(a+b) + cos(a-b)]
% -> tones at f_c ± f_Δ

f1 = fc - fDelta;
f2 = fc + fDelta;
disp("Expected spectral lines (Hz): " + f1 + " and " + f2);

% Spectrograms with increasing section length
Llist = [256 512 1024 2048 2500 3000 3500 4096 8192];

for Lsect = Llist
    do_spec(xx, fs, Lsect, sprintf('Beat spectrogram, L_{SECT}=%d', Lsect), false);
end

% Smallest section length that resolves two lines (from your observation)
Lsect_min = 3000;
Tsect_min = Lsect_min/fs;

% Comment for 2.1.2(c):
% At L_SECT=256, the spectrogram shows a single thick band near 1024 Hz
% (not two separate horizontal lines) → insufficient frequency resolution.

% RESULTS (2.1.2):
% Expected spectral lines: f1 = 1020 Hz, f2 = 1028 Hz.
% Smallest L_SECT resolving two lines: L_SECT,min = 3000 samples.
% T_SECT,min = L_SECT,min / fs = 3000/8000 = 0.375 s.


%% 2.1.3 Inverse Relationship: Section Length vs Frequency Resolution

% (a) Determine proportionality constant C from:
% |f1 - f2| = C / T_SECT

df = abs(f2 - f1);        % separation for fDelta = 4  (8 Hz)
C  = df * Tsect_min;      % C = |f1-f2| * T_SECT,min = 8 * 0.375 = 3.0
disp("Computed C = " + C);

% (b) Change fDelta to 16 Hz, predict Lsect, then verify
fDelta2 = 16;
f1b = fc - fDelta2;       % 1008 Hz
f2b = fc + fDelta2;       % 1040 Hz
df2 = abs(f2b - f1b);     % 32 Hz separation

Tsect_pred = C/df2;       % predicted section duration
Lsect_pred = Tsect_pred * fs;    % predicted length in samples (≈ 750)
Lsect_use  = 1024;        % convenient power-of-two window close to prediction

disp("Predicted Tsect for fDelta=16: " + Tsect_pred + " s");
disp("Predicted Lsect (theoretical) for fDelta=16: " + Lsect_pred);
disp("Using Lsect = " + Lsect_use + " samples for spectrogram.");

% Generate new beat signal and verify resolution
xx2 = Amp*cos(2*pi*fc*tt + 2*pi*rand) .* cos(2*pi*fDelta2*tt + 2*pi*rand);
do_spec(xx2, fs, Lsect_use, ...
    sprintf('f_\\Delta=16 spectrogram, L_{SECT}=%d', Lsect_use), false);

% RESULTS (2.1.3):
% |f1-f2| = 8 Hz for fDelta = 4.
% Measured minimum section length: L_SECT,min = 3000 samples
% → T_SECT,min = 3000/8000 = 0.375 s.
% Proportionality constant: C = |f1-f2| * T_SECT,min = 8 * 0.375 = 3.0.
%
% For fDelta = 16, the two tones are at 1008 Hz and 1040 Hz
% → |f1-f2| = 32 Hz.
% Predicted T_SECT = C / |f1-f2| = 3 / 32 ≈ 0.09375 s
% → Predicted L_SECT ≈ 0.09375 * 8000 = 750 samples.
% In practice, we used L_SECT = 1024 (a nearby power of two).
% The spectrogram with L_SECT = 1024 clearly shows two distinct lines
% near 1008 Hz and 1040 Hz, confirming that the inverse relationship
% is a good approximation.

%% Functions

function do_spec(x, fs, Lsect, titleStr, twoSided)
    if nargin < 5, twoSided = false; end
    figure;

    % If DSP-First plotspec exists, use it
    if exist('plotspec','file') == 2
        if twoSided
            plotspec(x + 1j*1e-12, fs, Lsect); % two-sided trick
        else
            plotspec(x, fs, Lsect);
        end
        colorbar; grid on; title(titleStr);
        return;
    end

    % REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Toolbox-free STFT fallback REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
    overlap = floor(Lsect/2);
    hop = Lsect - overlap;
    Nfft = Lsect;

    % Custom Hamming window (no toolbox)
    n = (0:Lsect-1).';
    w = 0.54 - 0.46*cos(2*pi*n/(Lsect-1));

    nFrames = floor((length(x) - Lsect)/hop) + 1;
    S = zeros(Nfft, nFrames);

    for m = 1:nFrames
        idx = (1:Lsect) + (m-1)*hop;
        frame = x(idx);
        frame = frame(:).*w;
        S(:,m) = fft(frame, Nfft);
    end

    T = ((0:nFrames-1)*hop + Lsect/2)/fs;

    if twoSided
        Splot = fftshift(S,1);
        F = (-Nfft/2:Nfft/2-1)/Nfft * fs;
    else
        halfN = floor(Nfft/2);
        Splot = S(1:halfN+1, :);
        F = (0:halfN)/Nfft * fs;
    end

    Mag = 20*log10(abs(Splot) + 1e-12);

    imagesc(T, F, Mag);
    axis xy; colorbar;
    xlabel('Time (s)'); ylabel('Frequency (Hz)');
    title([titleStr ' (STFT fallback)']);
    grid on;
end

##### SOURCE END #####
-->
</body>
</html>
